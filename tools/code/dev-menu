#!/usr/bin/env bash
########################
development_programming_tools() {
    RETURN_TO_WHERE='development_programming_tools'
    SOFTWARE=$(
        whiptail --title "Development" --menu \
            "æ‚¨æƒ³è¦å®‰è£…å“ªä¸ªè½¯ä»¶ï¼Ÿ\n Which software do you want to install?" 0 50 0 \
            "1" "ğŸ‡» ğŸ‡¸ VSCode ç°ä»£åŒ–ä»£ç ç¼–è¾‘å™¨" \
            "2" "ğŸ‡¦ ğŸ‡¸ Android-Studio(å®‰å“å¼€å‘å·¥å…·IDE)" \
            "3" "ğŸ‡® ğŸ‡¯ IntelliJ IDEA(javaç¼–ç¨‹è¯­è¨€é›†æˆå¼€å‘ç¯å¢ƒ)" \
            "4" "ğŸ‡µ ğŸ‡¾ PyCharm(pythoné›†æˆå¼€å‘ç¯å¢ƒ)" \
            "5" "ğŸ‡¼ ğŸ‡¸ Webstorm(JavaScript IDE,Webå‰ç«¯å¼€å‘å·¥å…·)" \
            "6" "ğŸ‡¨ ğŸ‡± CLion(C/C++é›†æˆå¼€å‘ç¯å¢ƒ)" \
            "7" "ğŸ‡¬ ğŸ‡´ GoLand(JetBrainsçš„Goå¼€å‘å·¥å…·)" \
            "8" "ğŸ‡¹ ğŸ‡¨ teamcity(æŒç»­é›†æˆContinue Integrationå·¥å…·)" \
            "9" "â™ github-desktop(x64,githubå®˜æ–¹æ¡Œé¢å®¢æˆ·ç«¯)" \
            "10" "âš›ï¸ atom(x64,ç±»Sublimeé£æ ¼æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œgithubå‡ºå“)" \
            "0" "ğŸŒš Return to previous menu è¿”å›ä¸Šçº§èœå•" \
            3>&1 1>&2 2>&3
    )
    case "${SOFTWARE}" in
    0 | "") software_center ;;
    1) which_vscode_edition ;;
    2) install_android_studio ;;
    *) echo "æ–°ç‰ˆå³å°†é›†æˆæœ¬å¼€å‘å·¥å…·çš„å®‰è£…ï¼Œæ•¬è¯·æœŸå¾…" ;;
    esac
       # 3) install_intellij_idea ;;
    ############################################
    press_enter_to_return
    development_programming_tools
}
###########
check_ide_version() {
    cat <<-ENDofTable
		â•”â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
		â•‘   â•‘          â•‘                   â•‘                    
		â•‘   â•‘ software â•‘    âœ¨æœ€æ–°ç‰ˆæœ¬     â•‘   æœ¬åœ°ç‰ˆæœ¬ ğŸª
		â•‘   â•‘          â•‘  Latest version   â•‘  Local version     
		â•‘---â•‘----------â•‘-------------------â•‘--------------------
		â•‘ 1 â•‘${GREP_NAME}                      ${LOCAL_OPT_APP_VERSION} 
		â•‘   â•‘          â•‘${THE_LATEST_APP_VERSION_CODE}

	ENDofTable
}
#########
uncompress_arch_pkg_tar_zst() {
    mkdir -p ${APP_OPT_DIR}
    cd ${APP_OPT_DIR}
    tar --zstd -xvf ${DOWNLOAD_PATH}/${ARCH_WALLPAPER_VERSION} &>/dev/null || zstdcat "${DOWNLOAD_PATH}/${ARCH_WALLPAPER_VERSION}" | tar xvf -
    cp -pf ${TMOE_TOOL_DIR}/code/lnk/${GREP_NAME}.desktop ${APPS_LNK_DIR}
}
###########
install_intellij_idea() {
    GREP_NAME='intellij-idea-ultimate-edition'
    check_opt_dir_01
    echo "æ­£åœ¨æ£€æµ‹ç‰ˆæœ¬æ›´æ–°ä¿¡æ¯..."
    echo "æœ¬ç‰ˆæœ¬ä¸ºæ——èˆ°ç‰ˆï¼Œå¦‚éœ€ä¸‹è½½ç¤¾åŒºç‰ˆï¼Œåˆ™è¯·æ‰‹åŠ¨æ‰“å¼€${YELLOW}https://www.jetbrains.com/idea/download/download-thanks.html?platform=linux&code=IIC${RESET}"
    check_archlinux_cn_html_date
    check_download_path
    ############
    THE_LATEST_APP_VERSION_CODE=$(cat index.html | grep '.pkg.tar.zst' | grep -Ev '.xz.sig|.zst.sig' | grep -v '\-jre\-' | grep "${GREP_NAME}" | tail -n 1 | cut -d '=' -f 3 | cut -d '"' -f 2 | sed "s@${GREP_NAME}-@@g" | sed 's@.pkg.tar.zst@@')
    LOCAL_OPT_APP_VERSION=$(cat ${TMOE_GIT_DIR} | head -n 1)
    grep_arch_linux_pkg_04
    uncompress_arch_pkg_tar_zst
    install_java
    echo "å®‰è£…å®Œæˆï¼Œå¦‚éœ€å¸è½½ï¼Œè¯·è¾“${RED}rm -rv${RESET}${BLUE}${APP_OPT_DIR} ${APPS_LNK_DIR}/${GREP_NAME}.desktop${RESET}"
}
##################
creat_android_studio_application_link() {
    cd ${APPS_LNK_DIR}
    #Icon=android-studio
    cat >android_studio.desktop <<-'EOF'
		[Desktop Entry]
		Name=Android Studio
		Type=Application
		Comment=Android Studio provides the fastest tools for building apps on every type of Android device.
		Exec=/opt/android-studio/bin/studio.sh %F
		Icon=/opt/android-studio/bin/studio.svg
		Categories=TextEditor;Development;IDE;
		MimeType=text/plain;inode/directory;
		Terminal=false
		Actions=new-empty-window;
		StartupNotify=true
		StartupWMClass=Android-Studio
	EOF
    chmod a+r android_studio.desktop
}
#########################
download_android_studio() {
    THE_LATEST_DEB_LINK="$(curl -Lv 'https://developer.android.google.cn/studio/#downloads' | grep 'linux' | grep href | grep studio | tail -n 1 | cut -d '"' -f 2)"
    echo ${THE_LATEST_DEB_LINK}
    echo "Do you want to download and install it?"
    do_you_want_to_continue
    aria2c --allow-overwrite=true -s 10 -x 10 -k 1M -o android_studio_linux_64bit.tar.gz ${THE_LATEST_DEB_LINK}
}
###############
check_android_studio() {
    mkdir -p ${HOME}/sd/Download
    cd ${HOME}/sd/Download
    if [ -e "/opt/android-studio" ]; then
        echo 'æ‚¨å·²å®‰è£…Android studio'
        echo "è‹¥æ‚¨éœ€è¦å¸è½½ï¼Œåˆ™è¯·è¾“${RED}rm -rv${RESET} ${HOME}/sd/Download/android_studio_linux_64bit.tar.gz ${BLUE}/opt/android-studio ${APPS_LNK_DIR}/android_studio.desktop${RESET};${RED}${TMOE_REMOVAL_COMMAND}${RESET} ${BLUE}default-jre${RESET}"
        echo "æ˜¯å¦éœ€è¦é‡æ–°å®‰è£…ï¼Ÿ"
        echo "Do you want to reinstall it?"
        do_you_want_to_continue
    fi
    if [ ! -e "android_studio_linux_64bit.tar.gz" ]; then
        download_android_studio
    fi
    install_java
}
##############
install_android_studio() {
    check_android_studio
    tar -zxvf android_studio_linux_64bit.tar.gz -C /opt
    creat_android_studio_application_link
    echo "å®‰è£…åŒ…ä½äº${BLUE}${HOME}/sd/Download/android_studio_linux_64bit.tar.gz${RESET}"
    echo "å®‰è£…å®Œæˆï¼Œå¦‚éœ€å¸è½½ï¼Œåˆ™è¯·è¾“${RED}rm -rv${RESET} ${BLUE}/opt/android-studio ${APPS_LNK_DIR}/android_studio.desktop${RESET};${RED}${TMOE_REMOVAL_COMMAND}${RESET} ${BLUE}default-jre${RESET}"
}
##################
development_programming_tools
